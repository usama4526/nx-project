<div class="stepper grid grid-cols-2" role="tablist">
  @for (step of steps; track step.key) {
    <button (click)="selectedStep.set($index)"
            class="step bg-white py-5 uppercase text-sm transition-colors font-normal select-none text-gray-800 border-b shadow-sm"
            [class.active]="selectedStep() === $index" role="tab" [attr.aria-selected]="selectedStep() === $index">
      {{ step.label }}
    </button>
  }
</div>

<div class="px-2 flex-1 max-h-full overflow-x-auto pb-10" role="tabpanel" aria-expanded="true">
  @switch (selectedStep()) {
    @case (1) {
      @if (builderUiService.portalOutletHasAttached()) {
        <ng-template [cdkPortalOutlet]="builderUiService.currentSettingsPortal()" />
      } @else {
        <p i18n="@@select_block" class="py-4 text-center">
          Click on a block, structure or column to edit its content.
        </p>
      }
    }
    @default {
      <h2 tailH2 i18n="@@blocks_list">Blocks</h2>
      <div class="grid gap-2 grid-cols-2" cdkDropList [cdkDropListConnectedTo]="columnsDropLists"
           [cdkDropListSortingDisabled]="true">
        @for (block of blocks; track block.type) {
          <div class="border rounded border-gray-200 bg-white text-sm uppercase text-center p-4 cursor-move select-none"
               cdkDrag [cdkDragData]="block">
            {{ block.title }}
          </div>
        }
      </div>
      <h2 tailH2 i18n="@@structude_list">Structures</h2>
      <div class="grid gap-2 grid-cols-2" cdkDropList [cdkDropListConnectedTo]="structuresDropLists"
           [cdkDropListSortingDisabled]="true">
        @for (structure of structures; track structure) {
          <div class="border rounded border-gray-200 bg-white cursor-move select-none flex gap-2 p-2" cdkDrag
               [cdkDragData]="structure.type">
            @for (col of structure.options.columns; track $index) {
              @let smallCol = structure.type === 'cols_21' && $index === 0 || structure.type === 'cols_12' && $index === 1;
              <div class="bg-gray-200 h-9 rounded" [ngClass]="{'w-5/12': smallCol, 'w-full': !smallCol}"></div>
            }
          </div>
        }
      </div>
      <div><button class="bg-red-500 text-white px-4 py-1.5 rounded w-full mt-4" (click)="showDeleteConfirmationDialog()">Delete All Blocks</button></div>
    }
  }
</div>

@if (readonly()) {
  <div class="absolute inset-0 bg-white opacity-80"></div>
}

<!-- Delete Confirmation Dialog -->
@if (showDeleteConfirmation) {
  <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md">
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-medium text-gray-900">Confirm Deletion</h3>
        <button
          (click)="hideDeleteConfirmationDialog()"
          class="text-gray-400 hover:text-gray-500 focus:outline-none"
        >
          <svg
            class="h-6 w-6"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M6 18L18 6M6 6l12 12"
            />
          </svg>
        </button>
      </div>
      
      <div class="mb-6">
        <p class="text-gray-700 mb-2">
          Are you sure you want to delete all blocks?
        </p>
        <p class="text-sm text-gray-500">
          This will remove all content blocks except Signature and Disclaimer.
        </p>
      </div>
      
      <div class="flex justify-end space-x-3">
        <button
          (click)="hideDeleteConfirmationDialog()"
          class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none"
        >
          Cancel
        </button>
        <button
          (click)="confirmDeleteAllBlocks()"
          class="px-4 py-2 border border-transparent rounded-md text-sm font-medium text-white bg-red-500 hover:bg-red-600 focus:outline-none"
        >
          Delete All
        </button>
      </div>
    </div>
  </div>
}
